<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistem Pelanggaran Santri</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">ðŸ“˜ Sistem Pelanggaran Santri</h1>

    <div id="status" class="p-4 mb-4 rounded-md bg-blue-50 border border-blue-300 text-blue-700">
      Menghubungkan ke database Supabase...
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold mb-4">Daftar Pelanggaran</h2>
      <table class="min-w-full border border-gray-200 rounded-lg overflow-hidden">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-4 py-2 text-left">No</th>
            <th class="px-4 py-2 text-left">Nama Santri</th>
            <th class="px-4 py-2 text-left">Kelas</th>
            <th class="px-4 py-2 text-left">Pelanggaran</th>
          </tr>
        </thead>
        <tbody id="pelanggaranTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
  window.__ENV = {
    SUPABASE_URL:  "https://qjcnqeyrzryuclwpmala.supabase.co",
    SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqY25xZXlyenJ5dWNsd3BtYWxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MDIwNjgsImV4cCI6MjA3Nzk3ODA2OH0.WwYGa4gKjoJ8n4fuqpQifgpLPJxHlZuUbtdhiF0OGs8",
  };
  </script>

  <script type="module">
  import { supabase } from './js/supabaseClient.js';

  const statusEl = document.getElementById('status');
  const tbody = document.getElementById('pelanggaranTableBody');

  async function loadData() {
    statusEl.textContent = 'ðŸ”„ Mengambil data...';

    // BACA DARI VIEW: v_violations_expanded
    const { data, error } = await supabase
      .from('v_violations_expanded')
      .select('id, student_name, class_name, violation, date_at, time_at, notes')
      .order('id', { ascending: false })
      .limit(50);

    if (error) {
      console.error(error);
      statusEl.textContent = 'âŒ Gagal memuat data: ' + error.message;
      return;
    }

    statusEl.textContent = `âœ… Terhubung. Menampilkan ${data.length} data terbaru.`;

    tbody.innerHTML = data.map((row, i) => `
      <tr class="border-b">
        <td class="px-4 py-2">${row.id ?? (i+1)}</td>
        <td class="px-4 py-2">${row.student_name}</td>
        <td class="px-4 py-2">${row.class_name}</td>
        <td class="px-4 py-2">${row.violation}</td>
      </tr>
    `).join('');
  }

  loadData();
</script>

</body>
</html>
